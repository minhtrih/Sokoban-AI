var json = {
    "listPoints": [
        {
            "row": 1, //person
            "point": {
                "x": 0,
                "y": 5,
                "t": 1,
                "l": 1,
                "r": 0,
                "b": 0
            }
        },
        {
            "row": 2,
            "point": {
                "x": 1,
                "y": 5,
                "t": 1,
                "l": 1,
                "r": 0,
                "b": 0
            }
        },
        {
            "row": 3,
            "point": {
                "x": 1,
                "y": 6,
                "t": 1,
                "l": 1,
                "r": 1,
                "b": 1
            }
        },
        {
            "row": 4,
            "point": {
                "x": 2,
                "y": 6,
                "t": 1,
                "l": 1,
                "r": 1,
                "b": 0
            }
        },
        {
            "row": 5,
            "point": {
                "x": 3,
                "y": 6,
                "t": 0,
                "l": 1,
                "r": 1,
                "b": 1
            }
        },
        {
            "row": 6,
            "point": {
                "x": 3,
                "y": 5,
                "t": 1,
                "l": 0,
                "r": 1,
                "b": 1
            }
        },
        {
            "row": 7,
            "point": {
                "x": 3,
                "y": 4,
                "t": 1,
                "l": 1,
                "r": 1,
                "b": 1
            }
        },
        {
            "row": 8,
            "point": {
                "x": 2,
                "y": 4,
                "t": 0,
                "l": 0,
                "r": 1,
                "b": 1
            }
        },
        {
            "row": 9,
            "point": {
                "x": 2,
                "y": 3,
                "t": 1,
                "l": 1,
                "r": 1,
                "b": 1
            }
        },
        {
            "row": 10,
            "point": {
                "x": 1,
                "y": 3,
                "t": 0,
                "l": 1,
                "r": 1,
                "b": 1
            }
        },
        {
            "row": 11,
            "point": {
                "x": 0,
                "y": 3,
                "t": 0,
                "l": 0,
                "r": 1,
                "b": 1
            }
        },
        {
            "row": 12,
            "point": {
                "x": 0,
                "y": 2,
                "t": 1,
                "l": 0,
                "r": 1,
                "b": 1
            }
        },
        {
            "row": 13,
            "point": {
                "x": 0,
                "y": 1,
                "t": 1,
                "l": 0,
                "r": 1,
                "b": 0
            }
        },
        {
            "row": 14,
            "point": {
                "x": 1,
                "y": 1,
                "t": 1,
                "l": 1,
                "r": 1,
                "b": 0
            }
        },
        {
            "row": 15,
            "point": {
                "x": 2,
                "y": 1,
                "t": 1,
                "l": 1,
                "r": 1,
                "b": 0
            }
        },
        {
            "row": 16,
            "point": {
                "x": 3,
                "y": 1,
                "t": 1,
                "l": 1,
                "r": 1,
                "b": 1
            }
        },
        {
            "row": 17,
            "point": {
                "x": 3,
                "y": 0,
                "t": 1,
                "l": 0,
                "r": 1,
                "b": 0
            }
        },
        {
            "row": 18,
            "point": {
                "x": 4,
                "y": 0,
                "t": 1,
                "l": 1,
                "r": 0,
                "b": 0
            }
        },
        {
            "row": 19,
            "point": {
                "x": 4,
                "y": 1,
                "t": 1,
                "l": 1,
                "r": 0,
                "b": 1
            }
        },
        {
            "row": 20,
            "point": {
                "x": 4,
                "y": 2,
                "t": 0,
                "l": 1,
                "r": 0,
                "b": 1
            }
        },
        {
            "row": 21,
            "point": {
                "x": 3,
                "y": 2,
                "t": 1,
                "l": 1,
                "r": 1,
                "b": 1
            }
        },
        {
            "row": 22,
            "point": {
                "x": 3,
                "y": 3,
                "t": 1,
                "l": 1,
                "r": 0,
                "b": 1
            }
        },
        {
            "row": 23,
            "point": {
                "x": 4,
                "y": 4,
                "t": 1,
                "l": 1,
                "r": 0,
                "b": 0
            }
        },
        {
            "row": 24,
            "point": {
                "x": 4,
                "y": 5,
                "t": 1,
                "l": 1,
                "r": 0,
                "b": 1
            }
        },
        {
            "row": 25,
            "point": {
                "x": 4,
                "y": 6,
                "t": 0,
                "l": 1,
                "r": 0,
                "b": 1
            }
        },
        {
            "row": 26, //box
            "point": {
                "x": 2,
                "y": 2,
                "t": 1,
                "l": 1,
                "r": 1,
                "b": 1
            }
        },
        {
            "row": 27,
            "point": {
                "x": 1,
                "y": 2,
                "t": 1,
                "l": 1,
                "r": 1,
                "b": 1
            }
        },
        {
            "row": 28,
            "point": {
                "x": 2,
                "y": 7,
                "t": 0,
                "l": 1,
                "r": 0,
                "b": 1
            }
        },
        {
            "row": 29,
            "point": {
                "x": 1,
                "y": 7,
                "t": 1,
                "l": 1,
                "r": 1,
                "b": 1
            }
        },
        {
            "row": 30,
            "point": {
                "x": 1,
                "y": 8,
                "t": 1,
                "l": 1,
                "r": 0,
                "b": 1
            }
        },
        {
            "row": 31,
            "point": {
                "x": 1,
                "y": 9,
                "t": 0,
                "l": 1,
                "r": 0,
                "b": 1
            }
        },
        {
            "row": 32, //goal
            "point": {
                "x": 0,
                "y": 9,
                "t": 0,
                "l": 0,
                "r": 1,
                "b": 1
            }
        },
        {
            "row": 33,
            "point": {
                "x": 0,
                "y": 8,
                "t": 1,
                "l": 0,
                "r": 1,
                "b": 1
            }
        },
        {
            "row": 34,
            "point": {
                "x": 0,
                "y": 7,
                "t": 1,
                "l": 0,
                "r": 1,
                "b": 1
            }
        },
        {
            "row": 35,
            "point": {
                "x": 0,
                "y": 6,
                "t": 1,
                "l": 0,
                "r": 1,
                "b": 1
            }
        }
    ]
};

function checkExits(x,y) {
    for (var i in json.listPoints) {
        if(x == json.listPoints[i].point.x && y == json.listPoints[i].point.y)
            return true;
    }
    return false;
}

function point() {
    var point = document.getElementsByTagName("g")[0];
    for (var i in json.listPoints) {
        var x = json.listPoints[i].point.x;
        var y = json.listPoints[i].point.y;
        if (checkExits(x,y)){
            var newElement = document.createElementNS("http://www.w3.org/2000/svg", 'circle'); //Create a path in SVG's namespace
            newElement.style.cx = (x+1)*80;
            newElement.style.cy = (9-y)*80;
            newElement.style.r = 3;
            point.appendChild(newElement);
        }
    }
    return point;
}

function drawMap() {
    var path = document.getElementById("svg-map"); //Get svg element
    for (var i in json.listPoints) {
        var x = json.listPoints[i].point.x;
        var y = json.listPoints[i].point.y;
        if(checkExits(x,y)){
            if(checkExits(x+1,y)){
                var newElement = document.createElementNS("http://www.w3.org/2000/svg", 'path'); //Create a path in SVG's namespace
                newElement.setAttribute("d","M " + (x+1)*80 + ' ' + (9-y)*80 + " l 80 0"); //Set path's data
                newElement.style.stroke = "#000"; //Set stroke colour
                newElement.style.strokeWidth = "3px"; //Set stroke width
                path.appendChild(newElement);
            }
            if(checkExits(x-1,y)){
                var newElement = document.createElementNS("http://www.w3.org/2000/svg", 'path'); //Create a path in SVG's namespace
                newElement.setAttribute("d","M " + (x+1)*80 + ' ' + (9-y)*80 + " l -80 0"); //Set path's data
                newElement.style.stroke = "#000"; //Set stroke colour
                newElement.style.strokeWidth = "3px"; //Set stroke width
                path.appendChild(newElement);
            }
            if(checkExits(x,y+1)){
                var newElement = document.createElementNS("http://www.w3.org/2000/svg", 'path'); //Create a path in SVG's namespace
                newElement.setAttribute("d","M " + (x+1)*80 + ' ' + (9-y)*80 + " l 0 -80"); //Set path's data
                newElement.style.stroke = "#000"; //Set stroke colour
                newElement.style.strokeWidth = "3px"; //Set stroke width
                path.appendChild(newElement);
            }
            if(checkExits(x,y-1)){
                var newElement = document.createElementNS("http://www.w3.org/2000/svg", 'path'); //Create a path in SVG's namespace
                newElement.setAttribute("d","M " + (x+1)*80 + ' ' + (9-y)*80 + " l 0 80"); //Set path's data
                newElement.style.stroke = "#000"; //Set stroke colour
                newElement.style.strokeWidth = "3px"; //Set stroke width
                path.appendChild(newElement);
            }
        }
    }
    return path;
}

function resultSokoban(result) {
    var x = 80;
    var y = 320;
    var box = [2,2];
    var player = [0,5];
    var point = x+','+y+' ';
    var i = 0;
    Box(2,2);
    Player(0,5);
    var interval = setInterval(function() {
        if (i%2 == 0){
            switch (result[i]) {
                case 'u':
                    y = y - 80;
                    point += x+','+y+' ';
                    updatePlayer(player[0], player[1]+1);
                    player = [player[0], player[1]+1];
                    if(x/80 - 1 == box[0] && 9- y/80 == box[1]){
                        updateBox(box[0], box[1]+1);
                        box = [box[0], box[1]+1];
                    }
                    break;
                case 'r':
                    x = x + 80;
                    point += x+','+y+' ';
                    updatePlayer(player[0]+1, player[1]);
                    player = [player[0]+1, player[1]];
                    if(x/80 - 1 == box[0] && 9- y/80 == box[1]){
                        updateBox(box[0]+1, box[1]);
                        box = [box[0]+1, box[1]];
                    }
                    break;
                case 'd':
                    y = y + 80;
                    point += x+','+y+' ';
                    updatePlayer(player[0], player[1]-1);
                    player = [player[0], player[1]-1];
                    if(x/80 - 1 == box[0] && 9- y/80 == box[1]){
                        updateBox(box[0], box[1]-1);
                        box = [box[0], box[1]-1];
                    }
                    break;
                case 'l':
                    x = x - 80;
                    point += x+','+y+' ';
                    updatePlayer(player[0]-1, player[1]);
                    player = [player[0]-1, player[1]];
                    if(x/80 - 1 == box[0] && 9- y/80 == box[1]){
                        updateBox(box[0]-1, box[1]);
                        box = [box[0]-1, box[1]];
                    }
                    break;
            }
            document.getElementsByTagName("polyline")[0].setAttribute("points", point);

        }
        i++;
        if (i>= result.length) {
            clearInterval(interval);
        }
    }, 500);
}

function updateBox(x,y) {
    var box = document.getElementById('box');
    box.style.x = (x+1)*80-10;
    box.style.y = (9-y)*80-10;
}

function Box(x,y) {
    var point = document.getElementsByTagName("g")[0];
    if (checkExits(x,y)){
        var newElement = document.createElementNS("http://www.w3.org/2000/svg", 'rect'); //Create a path in SVG's namespace
        newElement.setAttribute("id", "box");
        newElement.style.x = (x+1)*80-10;
        newElement.style.y = (9-y)*80-10;
        newElement.style.width = 20;
        newElement.style.height = 20;
        newElement.style.fill = 'blue';
        point.appendChild(newElement);
    }
    return point;
}

function updatePlayer(x,y) {
    var player = document.getElementById('player');
    player.style.cx = (x+1)*80;
    player.style.cy = (9-y)*80;
}

function Player(x,y) {
    var point = document.getElementsByTagName("g")[0];
    if (checkExits(x,y)){
        var newElement = document.createElementNS("http://www.w3.org/2000/svg", 'circle'); //Create a path in SVG's namespace
        newElement.setAttribute("id", "player");
        newElement.style.cx = (x+1)*80;
        newElement.style.cy = (9-y)*80;
        newElement.style.r = 15;
        newElement.style.fill = 'green';
        point.appendChild(newElement);
    }
    return point;
}

var result = "r u r r d d l d l d r d r u u u u r u l l l d l u u u ";
$(document).ready(function () {
    $(function () {
        drawMap();
        point();
        resultSokoban(result);
    });
});